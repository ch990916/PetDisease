<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.paramhwi.dogDisease.board.PostMapper">
	<insert id="writePost" parameterType="com.paramhwi.dogDisease.board.Post">
		insert into petdisease_post
		values(
			petdisease_post_seq.nextval,
			#{pp_content},
			#{pp_writer},
			#{pp_picture},
			sysdate
		)
	</insert>
	<select id="searchPage" parameterType="com.paramhwi.dogDisease.board.SearchInfo" resultType="com.paramhwi.dogDisease.board.Post">
		select *
		from (
			select *
			from (
				select rownum as rn, pp_no, pp_picture, pp_content, pp_date, pp_writer
				from (
					select *
					from petdisease_post
					where pp_content like '%'||#{searchWord}||'%' or pp_writer like '%'||#{searchWord}||'%'
					order by pp_date desc
				)
			)
			where rn&gt;=#{startNum} and rn&lt;=#{endNum}
		), (
			select pm_id, pm_photo, pm_nickname
			from petdisease_member
			where pm_id in (
				select pp_writer
				from (
					select rownum as rn, pp_writer
					from(
						select pp_writer
						from petdisease_post
						where pp_content like '%'||#{searchWord}||'%' or pp_writer like '%'||#{searchWord}||'%'
						order by pp_date desc
					)
				)
				where rn &gt;= #{startNum} and rn &lt;= #{endNum}
			)
		)
		where pm_id=pp_writer
	</select>
	
	<select id="getReply" parameterType="com.paramhwi.dogDisease.board.SearchInfo" resultType="com.paramhwi.dogDisease.board.PostReply">
		select *
		from petdisease_reply
		where pr_pp_no=#{pp_no}
		order by pr_date
	</select>
	
	<select id="searchContent" parameterType="com.paramhwi.dogDisease.board.Post" resultType="com.paramhwi.dogDisease.board.Post">
		select * from petdisease_post
		where pp_no=#{pp_no}
	</select>
	
	<select id="getAllPostCount" parameterType="com.paramhwi.dogDisease.board.SearchInfo" resultType="java.lang.Integer">
		select count(*) from petdisease_post
		where pp_content like '%'||#{searchWord}||'%' or pp_writer like '%'||#{searchWord}||'%'
	</select>
	
	<insert id="writeReply" parameterType="com.paramhwi.dogDisease.board.PostReply">
		insert into petdisease_reply
		values(
			petdisease_reply_seq.nextval,
			#{pr_pp_no},
			#{pr_writer},
			#{pr_content},
			sysdate
		)
	</insert>
	
	<delete id="deleteReply" parameterType="com.paramhwi.dogDisease.board.PostReply">
		delete from petdisease_reply
		where pr_no=#{pr_no}
	</delete>
	
	<delete id="deletePost" parameterType="com.paramhwi.dogDisease.board.Post">
		delete from petdisease_post
		where pp_no=#{pp_no}
	</delete>
	
	<update id="updatePost" parameterType="com.paramhwi.dogDisease.board.Post">
		update petdisease_post
		set pp_content=#{pp_content}, pp_picture=#{pp_picture}
		where pp_no=#{pp_no}
	</update>
</mapper>